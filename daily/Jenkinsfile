pipeline {
  agent any
  options { timestamps() }
  //triggers { cron('H/3 * * * *') } // daily

  stages {
    stage('Send to queue') {
      steps {
        script {
          def jsonText = readFile('daily/daily.json')
          echo "Sending ${jsonText.length()} bytes from daily.json to queue"
          build job: 'optimized/queue',
                wait: false,
                propagate: false,
                parameters: [
                  string(name: 'BATCH_JSON', value: jsonText),
                  string(name: 'SOURCE',     value: 'daily')
                ]
        }
      }
    }
  }
}
